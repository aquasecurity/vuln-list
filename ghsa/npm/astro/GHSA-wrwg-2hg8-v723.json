{
  "Severity": "HIGH",
  "UpdatedAt": "2025-11-19T20:00:15Z",
  "Package": {
    "Ecosystem": "NPM",
    "Name": "astro"
  },
  "Advisory": {
    "DatabaseId": 322310,
    "Id": "GSA_kwCzR0hTQS13cndnLTJoZzgtdjcyM84ABOsG",
    "GhsaId": "GHSA-wrwg-2hg8-v723",
    "References": [
      {
        "Url": "https://github.com/withastro/astro/security/advisories/GHSA-wrwg-2hg8-v723"
      },
      {
        "Url": "https://nvd.nist.gov/vuln/detail/CVE-2025-64764"
      },
      {
        "Url": "https://github.com/withastro/astro/commit/790d9425f39bbbb462f1c27615781cd965009f91"
      },
      {
        "Url": "https://github.com/advisories/GHSA-wrwg-2hg8-v723"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-wrwg-2hg8-v723"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2025-64764"
      }
    ],
    "Description": "## Summary\nAfter some research it appears that it is possible to obtain a reflected XSS when the server islands feature is used in the targeted application, **regardless of what was intended by the component template(s)**.\n\n## Details\nServer islands run in their own isolated context outside of the page request and use the following pattern path to hydrate the page: `/_server-islands/[name]`. These paths can be called via GET or POST and use three parameters:\n\n- `e`: component to export\n- `p`: the transmitted properties, encrypted\n- `s`: for the slots\n\nSlots are placeholders for external HTML content, and therefore allow, by default, the injection of code if the component template supports it, nothing exceptional in principle, just a feature.\n\nThis is where it becomes problematic: it is possible, independently of the component template used, even if it is completely empty, to inject a slot containing an XSS payload, whose parent is a tag whose name is is the absolute path of the island file. Enabling reflected XSS on any application, regardless of the component templates used, provided that the server islands is used at least once.\n\n**How ?**\n\nBy default, when a call is made to the endpoint `/_server-islands/[name]`, the value of the parameter `e` is `default`, pointing to a function exported by the component's module.\n\nUpon further investigation, we find that two other values ​​are possible for the component export (param `e`) in a typical configuration: `url` and `file`. `file` returns a string value corresponding to the absolute path of the island file. Since the value is of type `string`, it fulfills the following condition and leads to [this code block](https://github.com/withastro/astro/blob/190106149908ef6826899459146ef9f0ead602ab/packages/astro/src/runtime/server/render/component.ts#L279):\n\n\u003cimg width=\"804\" height=\"571\" alt=\"image\" src=\"https://github.com/user-attachments/assets/25ea6c16-fc27-477a-a1ad-e5edf0819b31\" /\u003e\n\nAn entire template is created, completely independently, and then returned:\n\n- the absolute path name is sanitized and then injected as the tag name\n- `childSlots`, the value provided to the `s` parameter, is injected as a child\n\nAll of this is done using `markHTMLString`. This allows the injection of any XSS payload, **even if the component template intended by the application is initially empty or does not provide for the use of slots.**\n\n## Proof of concept\nFor our Proof of Concept (PoC), we will use a minimal repository:\n- Latest Astro version at the time (5.15.6)\n- Use of Island servers, with a completely empty component, to demonstrate what we explained previously\n\n[Download the PoC repository](https://github.com/zhero-web-sec/astro-app-2)\n\nAccess the following URL and note the opening of the popup, demonstrating the reflected XSS:\n\nhttp://localhost:4321/_server-islands/ServerTime?e=file\u0026p=\u0026s={%22zhero%22:%22%3Cimg%20src=x%20onerror=alert(0)%3E%22}\n\n\u003cimg width=\"1781\" height=\"529\" alt=\"image\" src=\"https://github.com/user-attachments/assets/92f8134a-d1c7-4d3f-818e-214842c239c8\" /\u003e\n\nThe value of the parameter `s` must be in JSON format and the payload must be injected at the value level, not the key level : \n\n\u003cimg width=\"3273\" height=\"1840\" alt=\"for_respected_patron\" src=\"https://github.com/user-attachments/assets/8ac0079a-3dee-49e8-b639-322f77c84b83\" /\u003e\n\nDespite the initial template being empty, it is created because the value of the URL parameter `e` is set to `file`, as explained earlier. The parent tag is the name of the component's internal route, and its child is the value of the key \"zhero\" (*the name doesn't matter*) of the URL parameter `s`.\n\n## Credits\n- Allam Rachid ([zhero;](https://zhero-web-sec.github.io/research-and-things/))\n- Allam Yasser (inzo)",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2025-11-19T20:00:14Z",
    "Severity": "HIGH",
    "Summary": "Astro vulnerable to reflected XSS via the server islands feature",
    "UpdatedAt": "2025-11-19T20:00:15Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 7.1,
      "VectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:H/A:N"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "5.15.8"
      },
      "VulnerableVersionRange": "\u003c= 5.15.6"
    }
  ]
}