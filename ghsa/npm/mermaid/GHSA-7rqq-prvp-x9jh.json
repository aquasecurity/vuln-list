{
  "Severity": "MODERATE",
  "UpdatedAt": "2025-08-22T22:52:04Z",
  "Package": {
    "Ecosystem": "NPM",
    "Name": "mermaid"
  },
  "Advisory": {
    "DatabaseId": 308098,
    "Id": "GSA_kwCzR0hTQS03cnFxLXBydnAteDlqaM4ABLOC",
    "GhsaId": "GHSA-7rqq-prvp-x9jh",
    "References": [
      {
        "Url": "https://github.com/mermaid-js/mermaid/security/advisories/GHSA-7rqq-prvp-x9jh"
      },
      {
        "Url": "https://nvd.nist.gov/vuln/detail/CVE-2025-54881"
      },
      {
        "Url": "https://github.com/mermaid-js/mermaid/commit/5c69e5fdb004a6d0a2abe97e23d26e223a059832"
      },
      {
        "Url": "https://github.com/mermaid-js/mermaid/commit/685516a85ec1df64cefd4fd15f26533be87d458e"
      },
      {
        "Url": "https://github.com/advisories/GHSA-7rqq-prvp-x9jh"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-7rqq-prvp-x9jh"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2025-54881"
      }
    ],
    "Description": "### Summary\nIn the default configuration of mermaid 11.9.0, user supplied input for sequence diagram labels is passed to `innerHTML` during calculation of element size, causing XSS.\n\n### Details\nSequence diagram node labels with KaTeX delimiters are passed through `calculateMathMLDimensions`. This method passes the full label to `innerHTML` which allows allows malicious users to inject arbitrary HTML and cause XSS when mermaid-js is used in it's default configuration (with KaTeX support enabled). \n\nThe vulnerability lies here:\n\n```ts\nexport const calculateMathMLDimensions = async (text: string, config: MermaidConfig) =\u003e {\n  text = await renderKatex(text, config);\n  const divElem = document.createElement('div');\n  divElem.innerHTML = text; // XSS sink, text has not been sanitized.\n  divElem.id = 'katex-temp';\n  divElem.style.visibility = 'hidden';\n  divElem.style.position = 'absolute';\n  divElem.style.top = '0';\n  const body = document.querySelector('body');\n  body?.insertAdjacentElement('beforeend', divElem);\n  const dim = { width: divElem.clientWidth, height: divElem.clientHeight };\n  divElem.remove();\n  return dim;\n};\n```\n\nThe `calculateMathMLDimensions` method was introduced in 5c69e5fdb004a6d0a2abe97e23d26e223a059832 two years ago, which was released in [Mermaid 10.9.0](https://github.com/mermaid-js/mermaid/releases/tag/v10.9.0).\n\n### PoC\nRender the following diagram and observe the modified DOM.\n\n```\nsequenceDiagram\n    participant A as Alice\u003cimg src=\"x\" onerror=\"document.write(`xss on ${document.domain}`)\"\u003e$$\\\\text{Alice}$$\n    A-\u003e\u003eJohn: Hello John, how are you?\n    Alice-)John: See you later!\n```\n\nHere is a PoC on mermaid.live: https://mermaid.live/edit#pako:eNpVUMtOwzAQ_BWzyoFKaRTyaFILiio4IK7ckA-1km1iKbaLY6spUf4dJ0AF68uOZ2dm7REqXSNQ6PHDoarwWfDGcMkUudaJGysqceLKkj3hPdl3osJ7IRvSm-qBwcCAaIXGaONRrSsnUdnobITF28PQ954lwXglai25UNNhxWAXBMyXxcGOi-3kL_5k79e73atuFSUv2HWazH1IWn0m3CC5aPf4b3p2WK--BW-4DJCOWzQ3TM0HQmiMqIFa4zAEicZv4iGMsw0D26JEBtS3NR656ywDpiYv869_11r-Ko12TQv0yLveI3eqfcjP111HUNVonrRTFuhdsVgAHWEAmuRxlG7SuEzKMi-yJAnhAjTLIk_EcbFJtuk2y9MphM8lM47KIp--AOZghtU\n\n### Impact\nXSS on all sites that use mermaid and render user supplied diagrams without further sanitization.\n\n### Remediation\nThe value of the `text` argument for the `calculateMathMLDimensions` method needs to be sanitized before getting passed on to `innerHTML`.",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2025-08-19T20:16:58Z",
    "Severity": "MODERATE",
    "Summary": "Mermaid improperly sanitizes sequence diagram labels leading to XSS",
    "UpdatedAt": "2025-09-04T12:53:43Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 0,
      "VectorString": ""
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "10.9.4"
      },
      "VulnerableVersionRange": "\u003e= 10.9.0-rc.1, \u003c 10.9.4"
    },
    {
      "FirstPatchedVersion": {
        "Identifier": "11.10.0"
      },
      "VulnerableVersionRange": "\u003e= 11.0.0-alpha.1, \u003c 11.10.0"
    }
  ]
}