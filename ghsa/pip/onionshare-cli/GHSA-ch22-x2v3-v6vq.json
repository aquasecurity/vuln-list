{
  "Severity": "HIGH",
  "UpdatedAt": "2022-01-19T18:50:07Z",
  "Package": {
    "Ecosystem": "PIP",
    "Name": "onionshare-cli"
  },
  "Advisory": {
    "DatabaseId": 9334,
    "Id": "GSA_kwCzR0hTQS1jaDIyLXgydjMtdjZ2cc0kdg",
    "GhsaId": "GHSA-ch22-x2v3-v6vq",
    "References": [
      {
        "Url": "https://github.com/onionshare/onionshare/security/advisories/GHSA-ch22-x2v3-v6vq"
      },
      {
        "Url": "https://github.com/onionshare/onionshare/releases/tag/v2.5"
      },
      {
        "Url": "https://nvd.nist.gov/vuln/detail/CVE-2022-21690"
      },
      {
        "Url": "https://github.com/advisories/GHSA-ch22-x2v3-v6vq"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-ch22-x2v3-v6vq"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2022-21690"
      }
    ],
    "Description": "Between September 26, 2021 and October 8, 2021, [Radically Open Security](https://www.radicallyopensecurity.com/) conducted a penetration test of OnionShare 2.4, funded by the Open Technology Fund's [Red Team lab](https://www.opentech.fund/labs/red-team-lab/). This is an issue from that penetration test.\n\n- Vulnerability ID: OTF-001\n- Vulnerability type: Improper Input Sanitization\n- Threat level: Elevated\n\n## Description:\n\nThe `path` parameter of the requested URL is not sanitized before being passed to the QT frontend.\n\n## Technical description:\n\nThe `path` parameter is not sanitized before being passed to the constructor of the `QLabel`.\n\nhttps://github.com/onionshare/onionshare/blob/d08d5f0f32f755f504494d80794886f346fbafdb/desktop/src/onionshare/tab/mode/__init__.py#L499-L509\n\nhttps://github.com/onionshare/onionshare/blob/d08d5f0f32f755f504494d80794886f346fbafdb/desktop/src/onionshare/tab/mode/history.py#L456-L483\n\nhttps://doc.qt.io/qt-5/qlabel.html#details\n\n\u003e Warning: When passing a QString to the constructor or calling setText(), make sure to sanitize your input, as QLabel tries to guess whether it displays the text as plain text or as rich text, a subset of HTML 4 markup. You may want to call setTextFormat() explicitly, e.g. in case you expect the text to be in plain format but cannot control the text source (for instance when displaying data loaded from the Web).\n\nThis path is used in all components for displaying the server access history. This leads to a rendered HTML4 Subset (QT RichText editor) in the Onionshare frontend.\n\nIn the following example an adversary injects a crafted image file into an Onionshare instance with receive mode and renders it in the history component of the Onionshare application.\n\nThe only requirement is another visit to the shared site with the following parameter attached to the path of the URL:\n\n```\n\u003cimg src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAAFElEQVQY02Nk+M+ABzAxMIxKYwIAQC0BEwZFOw4AAAAASUVORK5CYII=' /\u003e\n```\n\nThis will be rendered as a green square in the history tab where the path value is supposed to be (the value itself is shown at the bottom of the page).\n\n![otf-001](https://user-images.githubusercontent.com/156128/140665358-ab9e5990-3e13-4e50-85fd-b8a6e323d299.png)\n\nPossible scenarios where this could lead to remote code execution would be a 0-day in libpng or other internal image rendering (OTF-014 (page 12)) of the QT framework.\n\nThe QT documentation indicates that external files could be rendered, but we were unable to find a QT code path allowing for it.\n\n## Impact:\n\nAn adversary with knowledge of the Onion service address in public mode or with authentication in private mode can render arbitrary HTML (QT-HTML4 Subset) in the server desktop application. This requires the desktop application with rendered history, therefore the impact is only elevated.\n\n## Recommendation:\n\n- Manually define the text format of the QLabel via `setTextFormat()`",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2022-01-21T23:20:25Z",
    "Severity": "HIGH",
    "Summary": "OTF-001: Improper Input Sanitation: The path parameter of the requested URL is not sanitized before being passed to the QT frontend",
    "UpdatedAt": "2023-01-29T05:06:36Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 8.7,
      "VectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:N"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "2.5"
      },
      "VulnerableVersionRange": "\u003c 2.5"
    }
  ]
}