{
  "Severity": "HIGH",
  "UpdatedAt": "2022-03-10T22:07:31Z",
  "Package": {
    "Ecosystem": "GO",
    "Name": "github.com/nats-io/nats-server/v2"
  },
  "Advisory": {
    "DatabaseId": 12596,
    "Id": "GSA_kwCzR0hTQS02aDNtLTM2dzgtaHY2OM0xNA",
    "GhsaId": "GHSA-6h3m-36w8-hv68",
    "References": [
      {
        "Url": "https://github.com/nats-io/nats-server/security/advisories/GHSA-6h3m-36w8-hv68"
      },
      {
        "Url": "https://github.com/nats-io/nats-server/pull/2917"
      },
      {
        "Url": "https://github.com/nats-io/nats-server/releases/tag/v2.7.4"
      },
      {
        "Url": "https://github.com/nats-io/nats-streaming-server/releases/tag/v0.24.3"
      },
      {
        "Url": "https://nvd.nist.gov/vuln/detail/CVE-2022-26652"
      },
      {
        "Url": "https://advisories.nats.io/CVE/CVE-2022-26652.txt"
      },
      {
        "Url": "https://github.com/nats-io/nats-server/releases"
      },
      {
        "Url": "http://www.openwall.com/lists/oss-security/2022/03/10/1"
      },
      {
        "Url": "https://github.com/advisories/GHSA-6h3m-36w8-hv68"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-6h3m-36w8-hv68"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2022-26652"
      }
    ],
    "Description": "(This document is canonically: \u003chttps://advisories.nats.io/CVE/CVE-2022-26652.txt\u003e)\n\n## Background\n\nNATS.io is a high performance open source pub-sub distributed communication technology, built for the cloud, on-premise, IoT, and edge computing.\n\nJetStream is the optional RAFT-based resilient persistent feature of NATS.\n\n\n## Problem Description\n\nThe JetStream streams can be backed up and restored via NATS. The backup format is a tar archive file.  Inadequate checks on the filenames within the archive file permit a so-called \"Zip Slip\" attack in the stream restore.\n\nNATS nats-server through 2022-03-09 (fixed in release 2.7.4) did not correctly sanitize elements of the archive file, thus a user of NATS\ncould cause the NATS server to write arbitrary content to an attacker-controlled filename.\n\n\n## Affected versions\n\nNATS Server:\n * 2.2.0 up to and including 2.7.3.\n   + Introduced with JetStream Restore functionality\n * Fixed with nats-io/nats-server: 2.7.4\n * Docker image:  nats \u003chttps://hub.docker.com/_/nats\u003e\n * NB users of OS package files from our releases: a change in goreleaser defaults, discovered late in the release process, moved the install directory from /usr/local/bin to /usr/bin; we are evaluating the correct solution for subsequent releases, but not recutting this release.\n\nNATS Streaming Server\n * 0.15.0 up to and including 0.24.2\n * Fixed with nats-io/nats-streaming-server: 0.24.3\n * Embeds a nats-server, but this server is the old approach which JetStream replaces, so unlikely (but not impossible) to be\n   configured with JS support\n\n\n## Workarounds\n\n * Disable JetStream for untrusted users.\n * If only one NATS account uses JetStream, such that cross-user attacks are not an issue, and any user in that account with access to the JetStream API is fully trusted anyway, then appropriate sandboxing techniques will prevent exploit.\n   + Eg, with systemd, the supplied util/nats-server-hardened.service example configuration demonstrates that NATS runs fine as an unprivileged user under ProtectSystem=strict and PrivateTmp=true restrictions; by only opening a ReadWritePaths hole for the JetStream storage area, the impact of this vulnerability is limited.\n\n\n## Solution\n\nUpgrade the NATS server to at least 2.7.4.\n\nWe fully support the util/nats-server-hardened.service configuration for running a NATS server and encourage this approach.\n\n\n## Credits\n\nThis issue was reported (on 2022-03-07) to the NATS Maintainers by\nYiming Xiang, TIANJI LAB of NSFOCUS.  \nThank you / 谢谢你！\n",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2022-03-10T22:07:30Z",
    "Severity": "HIGH",
    "Summary": "Arbitrary file write in nats-server",
    "UpdatedAt": "2023-02-03T05:06:49Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 6.5,
      "VectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "2.7.4"
      },
      "VulnerableVersionRange": "\u003e= 2.2.0, \u003c 2.7.4"
    }
  ]
}