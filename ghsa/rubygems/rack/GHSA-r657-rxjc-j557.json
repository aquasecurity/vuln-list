{
  "Severity": "MODERATE",
  "UpdatedAt": "2025-10-10T17:31:32Z",
  "Package": {
    "Ecosystem": "RUBYGEMS",
    "Name": "rack"
  },
  "Advisory": {
    "DatabaseId": 316449,
    "Id": "GSA_kwCzR0hTQS1yNjU3LXJ4amMtajU1N84ABNQh",
    "GhsaId": "GHSA-r657-rxjc-j557",
    "References": [
      {
        "Url": "https://github.com/rack/rack/security/advisories/GHSA-r657-rxjc-j557"
      },
      {
        "Url": "https://github.com/rack/rack/commit/57277b7741581fa827472c5c666f6e6a33abd784"
      },
      {
        "Url": "https://github.com/rack/rack/commit/7e69f65eefe9cd2868df9f9f3b0977b86f93523a"
      },
      {
        "Url": "https://github.com/rack/rack/commit/fba2c8bc63eb787ff4b19bc612d315fda6126d85"
      },
      {
        "Url": "https://github.com/advisories/GHSA-r657-rxjc-j557"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-r657-rxjc-j557"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2025-61780"
      }
    ],
    "Description": "## Summary\n\nA possible information disclosure vulnerability existed in `Rack::Sendfile` when running behind a proxy that supports `x-sendfile` headers (such as Nginx). Specially crafted headers could cause `Rack::Sendfile` to miscommunicate with the proxy and trigger unintended internal requests, potentially bypassing proxy-level access restrictions.\n\n## Details\n\nWhen `Rack::Sendfile` received untrusted `x-sendfile-type` or `x-accel-mapping` headers from a client, it would interpret them as proxy configuration directives. This could cause the middleware to send a \"redirect\" response to the proxy, prompting it to reissue a new internal request that was **not subject to the proxy's access controls**.\n\nAn attacker could exploit this by:\n1. Setting a crafted `x-sendfile-type: x-accel-redirect` header.\n2. Setting a crafted `x-accel-mapping` header.\n3. Requesting a path that qualifies for proxy-based acceleration.\n\n## Impact\n\nAttackers could bypass proxy-enforced restrictions and access internal endpoints intended to be protected (such as administrative pages). The vulnerability did not allow arbitrary file reads but could expose sensitive application routes.\n\nThis issue only affected systems meeting all of the following conditions:\n\n* The application used `Rack::Sendfile` with a proxy that supports `x-accel-redirect` (e.g., Nginx).\n* The proxy did **not** always set or remove the `x-sendfile-type` and `x-accel-mapping` headers.\n* The application exposed an endpoint that returned a body responding to `.to_path`.\n\n## Mitigation\n\n* Upgrade to a fixed version of Rack which requires explicit configuration to enable `x-accel-redirect`:\n\n  ```ruby\n  use Rack::Sendfile, \"x-accel-redirect\"\n  ```\n\n* Alternatively, configure the proxy to always set or strip the headers (you should be doing this!):\n\n  ```nginx\n  proxy_set_header x-sendfile-type x-accel-redirect;\n  proxy_set_header x-accel-mapping /var/www/=/files/;\n  ```\n\n* Or in Rails applications, disable sendfile completely:\n\n  ```ruby\n  config.action_dispatch.x_sendfile_header = nil\n  ```",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2025-10-10T17:31:31Z",
    "Severity": "MODERATE",
    "Summary": "Rack has a Possible Information Disclosure Vulnerability",
    "UpdatedAt": "2025-10-10T17:31:32Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 5.8,
      "VectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:N"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "3.2.3"
      },
      "VulnerableVersionRange": "\u003e= 3.2, \u003c 3.2.3"
    },
    {
      "FirstPatchedVersion": {
        "Identifier": "3.1.18"
      },
      "VulnerableVersionRange": "\u003e= 3.0, \u003c 3.1.18"
    },
    {
      "FirstPatchedVersion": {
        "Identifier": "2.2.20"
      },
      "VulnerableVersionRange": "\u003c 2.2.20"
    }
  ]
}