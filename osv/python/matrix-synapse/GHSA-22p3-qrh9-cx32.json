{
  "id": "GHSA-22p3-qrh9-cx32",
  "modified": "2024-02-21T05:32:46.405200Z",
  "published": "2022-06-29T21:51:23Z",
  "aliases": [
    "CVE-2022-31052",
    "PYSEC-2022-224"
  ],
  "summary": "URL previews of unusual or maliciously-crafted pages can crash Synapse media repositories or Synapse monoliths",
  "details": "### Impact\n\nURL previews of some web pages can exhaust the available stack space for the Synapse process due to unbounded recursion.\nThis is sometimes recoverable and leads to an error for the request causing the problem, but in other cases the Synapse process may crash altogether.\n\nIt is possible to exploit this maliciously, either by malicious users on the homeserver, or by remote users sending URLs that a local user's client may automatically request a URL preview for.\nRemote users are not able to exploit this directly, because [the URL preview endpoint is authenticated](https://spec.matrix.org/v1.2/client-server-api/#get_matrixmediav3preview_url).\n\n### Am I affected?\n\n* deployments with `url_preview_enabled: false` set in configuration are not affected.\n* deployments with `url_preview_enabled: true` set in configuration **are** affected.\n* deployments with no configuration value set for `url_preview_enabled` are not affected, because the default is `false`.\n\n### Patches\n\nAdministrators of homeservers with URL previews enabled are advised to upgrade to v1.61.1 or higher.\n\n### Workarounds\n\n* URL previews can be disabled in the configuration file by setting `url_preview_enabled: false`.\n* Deployments using workers can choose to offload URL previews to one or more dedicated worker(s), ensuring that a process crash does not disrupt other functionality of Synapse.\n\n### For more information\n\nIf you have any questions or comments about this advisory, e-mail us at [security@matrix.org](mailto:security@matrix.org).\n",
  "affected": [
    {
      "package": {
        "ecosystem": "PyPI",
        "name": "matrix-synapse",
        "purl": "pkg:pypi/matrix-synapse"
      },
      "ranges": [
        {
          "type": "ECOSYSTEM",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "1.61.1"
            }
          ]
        }
      ],
      "versions": [
        "0.33.5",
        "0.33.5.1",
        "0.33.6",
        "0.33.6rc1",
        "0.33.7",
        "0.33.7rc1",
        "0.33.7rc2",
        "0.33.8",
        "0.33.8rc2",
        "0.33.9",
        "0.34.0",
        "0.34.0.1",
        "0.34.0rc1",
        "0.34.0rc2",
        "0.34.1.1",
        "0.99.0",
        "0.99.0rc1",
        "0.99.0rc2",
        "0.99.0rc3",
        "0.99.0rc4",
        "0.99.1",
        "0.99.1.1",
        "0.99.1rc1",
        "0.99.1rc2",
        "0.99.2",
        "0.99.2rc1",
        "0.99.3",
        "0.99.3.1",
        "0.99.3.2",
        "0.99.3rc1",
        "0.99.4",
        "0.99.4rc1",
        "0.99.5",
        "0.99.5.1",
        "0.99.5.2",
        "0.99.5rc1",
        "1.0.0",
        "1.0.0rc1",
        "1.0.0rc2",
        "1.0.0rc3",
        "1.1.0",
        "1.1.0rc1",
        "1.1.0rc2",
        "1.10.0",
        "1.10.0rc1",
        "1.10.0rc2",
        "1.10.0rc3",
        "1.10.0rc5",
        "1.10.1",
        "1.11.0",
        "1.11.0rc1",
        "1.11.1",
        "1.12.0",
        "1.12.0rc1",
        "1.12.1",
        "1.12.1rc1",
        "1.12.2",
        "1.12.3",
        "1.12.4",
        "1.12.4rc1",
        "1.13.0",
        "1.13.0rc1",
        "1.13.0rc2",
        "1.13.0rc3",
        "1.14.0",
        "1.14.0rc1",
        "1.14.0rc2",
        "1.15.0",
        "1.15.0rc1",
        "1.15.1",
        "1.15.2",
        "1.16.0",
        "1.16.0rc1",
        "1.16.0rc2",
        "1.16.1",
        "1.17.0",
        "1.17.0rc1",
        "1.18.0",
        "1.18.0rc1",
        "1.18.0rc2",
        "1.19.0",
        "1.19.0rc1",
        "1.19.1",
        "1.19.1rc1",
        "1.19.2",
        "1.19.3",
        "1.2.0",
        "1.2.0rc1",
        "1.2.0rc2",
        "1.2.1",
        "1.20.0",
        "1.20.0rc1",
        "1.20.0rc2",
        "1.20.0rc3",
        "1.20.0rc4",
        "1.20.0rc5",
        "1.20.1",
        "1.21.0",
        "1.21.0rc1",
        "1.21.0rc2",
        "1.21.0rc3",
        "1.21.1",
        "1.21.2",
        "1.22.0",
        "1.22.0rc1",
        "1.22.0rc2",
        "1.22.1",
        "1.23.0",
        "1.23.0rc1",
        "1.23.1",
        "1.24.0",
        "1.24.0rc1",
        "1.24.0rc2",
        "1.25.0",
        "1.25.0rc1",
        "1.26.0",
        "1.26.0rc1",
        "1.26.0rc2",
        "1.27.0",
        "1.27.0rc1",
        "1.27.0rc2",
        "1.28.0",
        "1.28.0rc1",
        "1.29.0",
        "1.29.0rc1",
        "1.3.0",
        "1.3.0rc1",
        "1.3.1",
        "1.30.0",
        "1.30.0rc1",
        "1.30.1",
        "1.31.0",
        "1.31.0rc1",
        "1.32.0",
        "1.32.0rc1",
        "1.32.1",
        "1.32.2",
        "1.33.0",
        "1.33.0rc1",
        "1.33.0rc2",
        "1.33.1",
        "1.33.2",
        "1.34.0",
        "1.34.0rc1",
        "1.35.0",
        "1.35.0rc1",
        "1.35.0rc2",
        "1.35.0rc3",
        "1.35.1",
        "1.36.0",
        "1.36.0rc1",
        "1.36.0rc2",
        "1.37.0",
        "1.37.0rc1",
        "1.37.1",
        "1.37.1rc1",
        "1.38.0",
        "1.38.0rc1",
        "1.38.0rc2",
        "1.38.0rc3",
        "1.38.1",
        "1.39.0",
        "1.39.0rc1",
        "1.39.0rc2",
        "1.39.0rc3",
        "1.4.0",
        "1.4.0rc1",
        "1.4.0rc2",
        "1.4.1",
        "1.4.1rc1",
        "1.40.0",
        "1.40.0rc1",
        "1.40.0rc2",
        "1.40.0rc3",
        "1.41.0",
        "1.41.0rc1",
        "1.41.1",
        "1.42.0",
        "1.42.0rc1",
        "1.42.0rc2",
        "1.43.0",
        "1.43.0rc1",
        "1.43.0rc2",
        "1.44.0",
        "1.44.0rc1",
        "1.44.0rc2",
        "1.44.0rc3",
        "1.45.0",
        "1.45.0rc1",
        "1.45.0rc2",
        "1.45.1",
        "1.46.0",
        "1.46.0rc1",
        "1.47.0",
        "1.47.0rc1",
        "1.47.0rc2",
        "1.47.0rc3",
        "1.47.1",
        "1.48.0",
        "1.48.0rc1",
        "1.49.0",
        "1.49.0rc1",
        "1.49.2",
        "1.5.0",
        "1.5.0rc1",
        "1.5.0rc2",
        "1.5.1",
        "1.50.0",
        "1.50.0rc1",
        "1.50.0rc2",
        "1.50.1",
        "1.50.2",
        "1.51.0",
        "1.51.0rc1",
        "1.51.0rc2",
        "1.52.0",
        "1.52.0rc1",
        "1.53.0",
        "1.53.0rc1",
        "1.54.0",
        "1.54.0rc1",
        "1.55.0",
        "1.55.0rc1",
        "1.55.1",
        "1.55.2",
        "1.56.0",
        "1.56.0rc1",
        "1.57.0",
        "1.57.0rc1",
        "1.57.1",
        "1.58.0",
        "1.58.0rc2",
        "1.58.1",
        "1.59.0",
        "1.59.0rc1",
        "1.59.0rc2",
        "1.59.1",
        "1.6.0",
        "1.6.0rc1",
        "1.6.0rc2",
        "1.6.1",
        "1.60.0",
        "1.60.0rc1",
        "1.60.0rc2",
        "1.61.0",
        "1.61.0rc1",
        "1.7.0",
        "1.7.0rc1",
        "1.7.0rc2",
        "1.7.1",
        "1.7.2",
        "1.7.3",
        "1.8.0",
        "1.8.0rc1",
        "1.9.0",
        "1.9.0.dev1",
        "1.9.0.dev2",
        "1.9.0rc1",
        "1.9.1"
      ],
      "database_specific": {
        "source": "https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/06/GHSA-22p3-qrh9-cx32/GHSA-22p3-qrh9-cx32.json"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/matrix-org/synapse/security/advisories/GHSA-22p3-qrh9-cx32"
    },
    {
      "type": "ADVISORY",
      "url": "https://nvd.nist.gov/vuln/detail/CVE-2022-31052"
    },
    {
      "type": "WEB",
      "url": "https://github.com/matrix-org/synapse/commit/fa1308061802ac7b7d20e954ba7372c5ac292333"
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/matrix-org/synapse"
    },
    {
      "type": "WEB",
      "url": "https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2022-224.yaml"
    },
    {
      "type": "WEB",
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/7EARKKJZ2W7WUITFDT4EG4NVATFYJQHF"
    },
    {
      "type": "WEB",
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/QGSDQ4YAITCUACAB7SXQZDJIU3IQ4CJD"
    },
    {
      "type": "WEB",
      "url": "https://spec.matrix.org/v1.2/client-server-api/#get_matrixmediav3preview_url"
    }
  ]
}