{
  "Identifier": "CVE-2023-40015",
  "PackageSlug": "pypi/vyper",
  "Title": "Vyper: reversed order of side effects for some operations",
  "Description": "For the following (probably non-exhaustive) list of expressions, the compiler evaluates the arguments from right to left instead of left to right.\n\n```\n- unsafe_add\n- unsafe_sub\n- unsafe_mul\n- unsafe_div\n- pow_mod256\n- |, \u0026, ^ (bitwise operators)\n- bitwise_or (deprecated)\n- bitwise_and (deprecated)\n- bitwise_xor (deprecated)\n- raw_call\n- \u003c, \u003e, \u003c=, \u003e=, ==, !=\n- in, not in (when lhs and rhs are enums)\n```\n\nThis behaviour becomes a problem when the evaluation of one of the arguments produces side effects that other arguments depend on. The following expressions can produce side-effect:\n\n- state modifying external call\n- state modifying internal call\n- `raw_call`\n- `pop()` when used on a Dynamic Array stored in the storage\n- `create_minimal_proxy_to`\n- `create_copy_of`\n- `create_from_blueprint`\n\nFor example:\n\n```Vyper\nf:uint256\n\n@internal\ndef side_effect() -\u003e uint256:\nself.f = 12\nreturn 1\n\n@external\ndef foo() -\u003e uint256:\nreturn unsafe_add(self.f,self.side_effect()) # returns 13 instead of 1\n```\n\n```Vyper\na:DynArray[uint256, 12]\n@external\ndef bar() -\u003e bool:\nself.a = [1,2,3]\nreturn len(self.a) == self.a.pop() # return false instead of true\n```",
  "Date": "2025-06-18",
  "Pubdate": "2023-09-04",
  "AffectedRange": "\u003c=0.4.2",
  "FixedVersions": [],
  "AffectedVersions": "All versions up to 0.4.2",
  "NotImpacted": "",
  "Solution": "Unfortunately, there is no solution available yet.",
  "Urls": [
    "https://nvd.nist.gov/vuln/detail/CVE-2023-40015",
    "https://github.com/advisories/GHSA-g2xh-c426-v8mf",
    "https://github.com/vyperlang/vyper/security/advisories/GHSA-g2xh-c426-v8mf",
    "https://github.com/vyperlang/vyper/issues/3604",
    "https://github.com/vyperlang/vyper/issues/4019",
    "https://github.com/vyperlang/vyper/pull/4157",
    "https://github.com/pypa/advisory-database/tree/main/vulns/vyper/PYSEC-2023-167.yaml",
    "https://github.com/vyperlang/vyper"
  ],
  "CvssV2": "",
  "CvssV3": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N",
  "UUID": "7ea56a90-1283-47d2-9a91-28ddf0d83f80"
}