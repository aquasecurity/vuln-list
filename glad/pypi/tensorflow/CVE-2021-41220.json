{
  "Identifier": "CVE-2021-41220",
  "PackageSlug": "pypi/tensorflow",
  "Title": "Use after free / memory leak in `CollectiveReduceV2`",
  "Description": "The [async implementation](https://github.com/tensorflow/tensorflow/blob/8d72537c6abf5a44103b57b9c2e22c14f5f49698/tensorflow/core/kernels/collective_ops.cc#L604-L615) of `CollectiveReduceV2` suffers from a memory leak and a use after free:\n\n```python\nimport tensorflow as tf\n\ntf.raw_ops.CollectiveReduceV2(\ninput=[],\ngroup_size=[-10, -10, -10],\ngroup_key=[-10, -10],\ninstance_key=[-10],\nordering_token=[],\nmerge_op='Mul',\nfinal_op='Div')\n```\n\nThis occurs due to the asynchronous computation and the fact that objects that have been `std::move()`d from are still accessed:\n\n```cc\nauto done_with_cleanup = [col_params, done = std::move(done)]() {\ndone();\ncol_params-\u003eUnref();\n};\nOP_REQUIRES_OK_ASYNC(c,\nFillCollectiveParams(col_params, REDUCTION_COLLECTIVE,\n/*group_size*/ c-\u003einput(1),\n/*group_key*/ c-\u003einput(2),\n/*instance_key*/ c-\u003einput(3)),\ndone);\n```\n\nHere, `done` is already moved from by the time `OP_REQUIRES_OK_ASYNC` macro needs to invoke it in case of errors. In this case, we get an undefined behavior, which can manifest via crashes, `std::bad_alloc` throws or just memory leaks.",
  "Date": "2024-11-07",
  "Pubdate": "2021-11-10",
  "AffectedRange": "\u003e=2.6.0,\u003c2.6.1||==2.6.0",
  "FixedVersions": [
    "2.6.1"
  ],
  "AffectedVersions": "All versions starting from 2.6.0 before 2.6.1, version 2.6.0",
  "NotImpacted": "",
  "Solution": "Upgrade to version 2.6.1 or above.",
  "Urls": [
    "https://nvd.nist.gov/vuln/detail/CVE-2021-41220",
    "https://github.com/advisories/GHSA-gpfh-jvf9-7wg5",
    "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-gpfh-jvf9-7wg5",
    "https://github.com/tensorflow/tensorflow/commit/ca38dab9d3ee66c5de06f11af9a4b1200da5ef75",
    "https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-cpu/PYSEC-2021-629.yaml",
    "https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-gpu/PYSEC-2021-827.yaml",
    "https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow/PYSEC-2021-412.yaml",
    "https://github.com/tensorflow/tensorflow"
  ],
  "CvssV2": "AV:L/AC:L/Au:N/C:P/I:P/A:P",
  "CvssV3": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
  "UUID": "2ff91047-64fa-4bde-a4dd-0828cd52a1b8"
}