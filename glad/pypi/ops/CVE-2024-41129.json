{
  "Identifier": "CVE-2024-41129",
  "PackageSlug": "pypi/ops",
  "Title": "ops leaking secrets if `subprocess.CalledProcessError` happens with a `secret-*` CLI command",
  "Description": "The issue here is that we pass the secret content as one of the args via CLI. This issue may affect any of our charms that are using: Juju (\u003e=3.0), Juju secrets and not correctly capturing and processing `subprocess.CalledProcessError`.\n\nThere are two points that may log this command, in different files:\n\nFirst, if there is an error during a secret handling, there will be a `subprocess.CalledProcessError`, which will contain the CLI comand + all its args. This is going to be logged in any logging level. This exception, if not caught by the charm, will bubble up to the `/var/log/juju/` logs and syslog journal. Now, on Ubuntu 22.04, these logs are protected with:\n```\n$ juju ssh -m controller 0 -- ls -la /var/log/juju/\ntotal 224\ndrwxr-xr-x 2 syslog adm      4096 Jul 14 10:59 .\ndrwxrwxr-x 9 root   syslog   4096 Jul 14 10:58 ..\n-rw-r----- 1 syslog adm     20124 Jul 14 11:10 audit.log\n-rw-r----- 1 syslog adm    110432 Jul 14 11:10 logsink.log\n-rw-r----- 1 syslog adm     80783 Jul 14 11:06 machine-0.log\n-rw-r----- 1 syslog adm       766 Jul 14 11:10 machine-lock.log\n-rw-r--r-- 1 root   root        0 Jul 14 10:59 slow-query.log\n-rw-r----- 1 syslog adm      3732 Jul 14 11:10 unit-controller-0.log\n```\n\nSecond, certain audit setups may log terminal commands, which would result in this command being logged with its secrets. It is unknown if this is done on ubuntu security benchmarks, such as CIS hardening.\n\nKeep in mind these logs may be copied or even backed up. Which exposes it to more services in the user's environment (e.g. CI runs in GH - although these are dummy password generated per test only).",
  "Date": "2024-07-22",
  "Pubdate": "2024-07-22",
  "AffectedRange": "\u003e=2.0.0,\u003c2.15.0",
  "FixedVersions": [
    "2.15.0"
  ],
  "AffectedVersions": "All versions starting from 2.0.0 before 2.15.0",
  "NotImpacted": "All versions before 2.0.0, all versions starting from 2.15.0",
  "Solution": "Upgrade to version 2.15.0 or above.",
  "Urls": [
    "https://nvd.nist.gov/vuln/detail/CVE-2024-41129",
    "https://github.com/advisories/GHSA-hcmv-jmqh-fjgm",
    "https://github.com/canonical/operator/security/advisories/GHSA-hcmv-jmqh-fjgm",
    "https://github.com/canonical/operator/commit/fea6d2072435a62170d4c01272572f1a7e916e61",
    "https://github.com/canonical/operator"
  ],
  "CvssV2": "",
  "CvssV3": "CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:N",
  "UUID": "c63153fa-3f64-4590-ae5d-de33680e7ff0"
}