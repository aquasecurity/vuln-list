{
  "Identifier": "CVE-2024-48917",
  "PackageSlug": "packagist/phpoffice/phpexcel",
  "Title": "XXE in PHPSpreadsheet's XLSX reader",
  "Description": "The `XmlScanner` class has a `scan` method which should prevent XXE attacks.\n\nHowever, we found another bypass than the previously reported `CVE-2024-47873`, the regexes from the `findCharSet` method, which is used for determining the current encoding can be bypassed by using a payload in the encoding UTF-7, and adding at end of the file a comment with the value `encoding=\"UTF-8\"` with `\"`, which is matched by the first regex, so that `encoding='UTF-7'` with single quotes `'` in the XML header is not matched by the second regex:\n\n```\n$patterns = [\n'/encoding\\\\s*=\\\\s*\"([^\"]*]?)\"/',\n\"/encoding\\\\s*=\\\\s*'([^']*?)'/\",\n];\n```\n\nA payload for the `workbook.xml` file can for example be created with CyberChef.\nIf you open an Excel file containing the payload from the link above stored in the `workbook.xml` file with PhpSpreadsheet, you will receive an HTTP request on `127.0.0.1:12345`. You can test that an HTTP request is created by running the `nc -nlvp 12345` command before opening the file containing the payload with PhpSpreadsheet.\n\nTo create the payload you need:\n1. Create a file containing `\u003c?xml version = \"1.0\" encoding='UTF-7'` in an XML file\n2. Use the link attached above to create your XXE payload and add it to the XML file.\n3. Add `+ADw-+ACE---encoding=\"UTF-8\"--+AD4-` to the end of the XML file, which is matched by the first regex.",
  "Date": "2025-03-06",
  "Pubdate": "2024-11-18",
  "AffectedRange": "\u003c=1.8.2",
  "FixedVersions": [],
  "AffectedVersions": "All versions up to 1.8.2",
  "NotImpacted": "",
  "Solution": "Unfortunately, there is no solution available yet.",
  "Urls": [
    "https://nvd.nist.gov/vuln/detail/CVE-2024-48917",
    "https://github.com/advisories/GHSA-7cc9-j4mv-vcjp",
    "https://github.com/PHPOffice/PhpSpreadsheet/security/advisories/GHSA-7cc9-j4mv-vcjp",
    "https://github.com/PHPOffice/PhpSpreadsheet",
    "https://github.com/PHPOffice/PhpSpreadsheet/blob/39fc51309181e82593b06e2fa8e45ef8333a0335/src/PhpSpreadsheet/Reader/Security/XmlScanner.php",
    "https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing"
  ],
  "CvssV2": "",
  "CvssV3": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
  "UUID": "33df09f9-f014-4949-a9e9-ea406894b23a"
}