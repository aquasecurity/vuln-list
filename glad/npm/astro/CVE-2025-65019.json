{
  "Identifier": "CVE-2025-65019",
  "PackageSlug": "npm/astro",
  "Title": "Astro Cloudflare adapter has Stored Cross-site Scripting vulnerability in /_image endpoint",
  "Description": "**Summary**\nA Cross-Site Scripting (XSS) vulnerability exists in Astro when using the **@astrojs/cloudflare** adapter with `output: 'server'`. The built-in image optimization endpoint (`/_image`) uses `isRemoteAllowed()` from Astro’s internal helpers, which **unconditionally allows `data:` URLs**. When the endpoint receives a valid `data:` URL pointing to a malicious SVG containing JavaScript, and the Cloudflare-specific implementation performs a **302 redirect back to the original `data:` URL**, the browser directly executes the embedded JavaScript. This completely bypasses any domain allow-listing (`image.domains` / `image.remotePatterns`) and typical Content Security Policy mitigations.\n\n**Affected Versions**\n- `@astrojs/cloudflare` ≤ 12.6.10 (and likely all previous versions)\n- Astro ≥ 4.x when used with `output: 'server'` and the Cloudflare adapter\n\n**Root Cause – Vulnerable Code**\nFile: `node_modules/@astrojs/internal-helpers/src/remote.ts`\n\n```ts\nexport function isRemoteAllowed(src: string, ...): boolean {\nif (!URL.canParse(src)) {\nreturn false;\n}\nconst url = new URL(src);\n\n// Data URLs are always allowed\nif (url.protocol === 'data:') {\nreturn true;\n}\n\n// Non-http(s) protocols are never allowed\nif (!['http:', 'https:'].includes(url.protocol)) {\nreturn false;\n}\n// ... further http/https allow-list checks\n}\n```\n\nIn the **Cloudflare adapter**, the `/_image` endpoint contains logic similar to:\n\n```ts\nconst href = ctx.url.searchParams.get('href');\nif (!href) {\n// return error\n}\n\nif (isRemotePath(href)) {\nif (isRemoteAllowed(href, imageConfig) === false) {\n// return error\n} else {\n//redirect to return the image\nreturn Response.redirect(href, 302);\n}\n}\n```\n\nBecause `data:` URLs are considered “allowed”, a request such as:\n`https://example.com/_image?href=data:image/svg+xml;base64,PHN2Zy... (base64-encoded malicious SVG)`\n\ntriggers a **302 redirect directly to the `data:` URL**, causing the browser to render and execute the malicious JavaScript inside the SVG.\n\n**Proof of Concept (PoC)**\n\n1. Create a minimal Astro project with Cloudflare adapter (`output: 'server'`).\n2. Deploy to Cloudflare Pages or Workers.\n3. Request the image endpoint with the following payload:",
  "Date": "2025-11-27",
  "Pubdate": "2025-11-19",
  "AffectedRange": "\u003c5.15.9",
  "FixedVersions": [
    "5.15.9"
  ],
  "AffectedVersions": "All versions before 5.15.9",
  "NotImpacted": "All versions starting from 5.15.9",
  "Solution": "Upgrade to version 5.15.9 or above.",
  "Urls": [
    "https://nvd.nist.gov/vuln/detail/CVE-2025-65019",
    "https://github.com/advisories/GHSA-fvmw-cj7j-j39q",
    "https://github.com/withastro/astro/security/advisories/GHSA-fvmw-cj7j-j39q",
    "https://github.com/withastro/astro/commit/9e9c528191b6f5e06db9daf6ad26b8f68016e533",
    "https://github.com/withastro/astro"
  ],
  "CvssV2": "",
  "CvssV3": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N",
  "UUID": "f6ba4a2b-7cab-47b5-9177-1386f4ee422e"
}